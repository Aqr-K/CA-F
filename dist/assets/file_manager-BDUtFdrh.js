import{af as He,ag as Oe,a as he,b as Ae,o as p,h as ee,i as e,w as t,B as K,ah as lt,X as ue,a5 as ze,a6 as ot,r as L,v as je,c as g,a9 as le,e as a,x as oe,ai as rt,aj as Ie,I as We,j as Te,k as Ye,g as ge,ak as Ee,al as Ze,C as W,t as q,l as Le,am as Ke,F as ye,E as O,L as ve,K as ie,_ as Re,S as qe,u as Je,q as Ve,ad as it,an as xe,ao as we,M as $e,aa as st,Y as _e,Z as Q,ap as ut,a8 as Me,aq as Ge,ar as Qe,$ as Fe,as as Ue,G as Xe,D as ke,at as dt,T as Be,au as ct,av as mt,Q as ce,ae as ft,aw as pt,a7 as vt,W as me,U as pe,ax as ht,ay as yt,az as _t,n as gt,aA as xt,aB as $t,aC as bt,H as wt}from"./index-B9z1J0xF.js";import{F as Ce}from"./variable-YuAkxgsS.js";var De={exports:{}},Ne;function et(){return Ne||(Ne=1,function(m,Z){(function(S,b){m.exports=b()})(He,function(){var S=1e3,b=6e4,x=36e5,T="millisecond",_="second",I="minute",u="hour",$="day",B="week",M="month",C="quarter",w="year",U="date",J="Invalid Date",k=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,z=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,V={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(v){var r=["th","st","nd","rd"],l=v%100;return"["+v+(r[(l-20)%10]||r[l]||r[0])+"]"}},o=function(v,r,l){var c=String(v);return!c||c.length>=r?v:""+Array(r+1-c.length).join(l)+v},R={s:o,z:function(v){var r=-v.utcOffset(),l=Math.abs(r),c=Math.floor(l/60),n=l%60;return(r<=0?"+":"-")+o(c,2,"0")+":"+o(n,2,"0")},m:function v(r,l){if(r.date()<l.date())return-v(l,r);var c=12*(l.year()-r.year())+(l.month()-r.month()),n=r.clone().add(c,M),i=l-n<0,h=r.clone().add(c+(i?-1:1),M);return+(-(c+(l-n)/(i?n-h:h-n))||0)},a:function(v){return v<0?Math.ceil(v)||0:Math.floor(v)},p:function(v){return{M,y:w,w:B,d:$,D:U,h:u,m:I,s:_,ms:T,Q:C}[v]||String(v||"").toLowerCase().replace(/s$/,"")},u:function(v){return v===void 0}},s="en",F={};F[s]=V;var ae="$isDayjsObject",ne=function(v){return v instanceof re||!(!v||!v[ae])},se=function v(r,l,c){var n;if(!r)return s;if(typeof r=="string"){var i=r.toLowerCase();F[i]&&(n=i),l&&(F[i]=l,n=i);var h=r.split("-");if(!n&&h.length>1)return v(h[0])}else{var D=r.name;F[D]=r,n=D}return!c&&n&&(s=n),n||!c&&s},N=function(v,r){if(ne(v))return v.clone();var l=typeof r=="object"?r:{};return l.date=v,l.args=arguments,new re(l)},Y=R;Y.l=se,Y.i=ne,Y.w=function(v,r){return N(v,{locale:r.$L,utc:r.$u,x:r.$x,$offset:r.$offset})};var re=function(){function v(l){this.$L=se(l.locale,null,!0),this.parse(l),this.$x=this.$x||l.x||{},this[ae]=!0}var r=v.prototype;return r.parse=function(l){this.$d=function(c){var n=c.date,i=c.utc;if(n===null)return new Date(NaN);if(Y.u(n))return new Date;if(n instanceof Date)return new Date(n);if(typeof n=="string"&&!/Z$/i.test(n)){var h=n.match(k);if(h){var D=h[2]-1||0,A=(h[7]||"0").substring(0,3);return i?new Date(Date.UTC(h[1],D,h[3]||1,h[4]||0,h[5]||0,h[6]||0,A)):new Date(h[1],D,h[3]||1,h[4]||0,h[5]||0,h[6]||0,A)}}return new Date(n)}(l),this.init()},r.init=function(){var l=this.$d;this.$y=l.getFullYear(),this.$M=l.getMonth(),this.$D=l.getDate(),this.$W=l.getDay(),this.$H=l.getHours(),this.$m=l.getMinutes(),this.$s=l.getSeconds(),this.$ms=l.getMilliseconds()},r.$utils=function(){return Y},r.isValid=function(){return this.$d.toString()!==J},r.isSame=function(l,c){var n=N(l);return this.startOf(c)<=n&&n<=this.endOf(c)},r.isAfter=function(l,c){return N(l)<this.startOf(c)},r.isBefore=function(l,c){return this.endOf(c)<N(l)},r.$g=function(l,c,n){return Y.u(l)?this[c]:this.set(n,l)},r.unix=function(){return Math.floor(this.valueOf()/1e3)},r.valueOf=function(){return this.$d.getTime()},r.startOf=function(l,c){var n=this,i=!!Y.u(c)||c,h=Y.p(l),D=function(H,f){var G=Y.w(n.$u?Date.UTC(n.$y,f,H):new Date(n.$y,f,H),n);return i?G:G.endOf($)},A=function(H,f){return Y.w(n.toDate()[H].apply(n.toDate("s"),(i?[0,0,0,0]:[23,59,59,999]).slice(f)),n)},P=this.$W,E=this.$M,X=this.$D,de="set"+(this.$u?"UTC":"");switch(h){case w:return i?D(1,0):D(31,11);case M:return i?D(1,E):D(0,E+1);case B:var y=this.$locale().weekStart||0,d=(P<y?P+7:P)-y;return D(i?X-d:X+(6-d),E);case $:case U:return A(de+"Hours",0);case u:return A(de+"Minutes",1);case I:return A(de+"Seconds",2);case _:return A(de+"Milliseconds",3);default:return this.clone()}},r.endOf=function(l){return this.startOf(l,!1)},r.$set=function(l,c){var n,i=Y.p(l),h="set"+(this.$u?"UTC":""),D=(n={},n[$]=h+"Date",n[U]=h+"Date",n[M]=h+"Month",n[w]=h+"FullYear",n[u]=h+"Hours",n[I]=h+"Minutes",n[_]=h+"Seconds",n[T]=h+"Milliseconds",n)[i],A=i===$?this.$D+(c-this.$W):c;if(i===M||i===w){var P=this.clone().set(U,1);P.$d[D](A),P.init(),this.$d=P.set(U,Math.min(this.$D,P.daysInMonth())).$d}else D&&this.$d[D](A);return this.init(),this},r.set=function(l,c){return this.clone().$set(l,c)},r.get=function(l){return this[Y.p(l)]()},r.add=function(l,c){var n,i=this;l=Number(l);var h=Y.p(c),D=function(E){var X=N(i);return Y.w(X.date(X.date()+Math.round(E*l)),i)};if(h===M)return this.set(M,this.$M+l);if(h===w)return this.set(w,this.$y+l);if(h===$)return D(1);if(h===B)return D(7);var A=(n={},n[I]=b,n[u]=x,n[_]=S,n)[h]||1,P=this.$d.getTime()+l*A;return Y.w(P,this)},r.subtract=function(l,c){return this.add(-1*l,c)},r.format=function(l){var c=this,n=this.$locale();if(!this.isValid())return n.invalidDate||J;var i=l||"YYYY-MM-DDTHH:mm:ssZ",h=Y.z(this),D=this.$H,A=this.$m,P=this.$M,E=n.weekdays,X=n.months,de=n.meridiem,y=function(f,G,j,te){return f&&(f[G]||f(c,i))||j[G].slice(0,te)},d=function(f){return Y.s(D%12||12,f,"0")},H=de||function(f,G,j){var te=f<12?"AM":"PM";return j?te.toLowerCase():te};return i.replace(z,function(f,G){return G||function(j){switch(j){case"YY":return String(c.$y).slice(-2);case"YYYY":return Y.s(c.$y,4,"0");case"M":return P+1;case"MM":return Y.s(P+1,2,"0");case"MMM":return y(n.monthsShort,P,X,3);case"MMMM":return y(X,P);case"D":return c.$D;case"DD":return Y.s(c.$D,2,"0");case"d":return String(c.$W);case"dd":return y(n.weekdaysMin,c.$W,E,2);case"ddd":return y(n.weekdaysShort,c.$W,E,3);case"dddd":return E[c.$W];case"H":return String(D);case"HH":return Y.s(D,2,"0");case"h":return d(1);case"hh":return d(2);case"a":return H(D,A,!0);case"A":return H(D,A,!1);case"m":return String(A);case"mm":return Y.s(A,2,"0");case"s":return String(c.$s);case"ss":return Y.s(c.$s,2,"0");case"SSS":return Y.s(c.$ms,3,"0");case"Z":return h}return null}(f)||h.replace(":","")})},r.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},r.diff=function(l,c,n){var i,h=this,D=Y.p(c),A=N(l),P=(A.utcOffset()-this.utcOffset())*b,E=this-A,X=function(){return Y.m(h,A)};switch(D){case w:i=X()/12;break;case M:i=X();break;case C:i=X()/3;break;case B:i=(E-P)/6048e5;break;case $:i=(E-P)/864e5;break;case u:i=E/x;break;case I:i=E/b;break;case _:i=E/S;break;default:i=E}return n?i:Y.a(i)},r.daysInMonth=function(){return this.endOf(M).$D},r.$locale=function(){return F[this.$L]},r.locale=function(l,c){if(!l)return this.$L;var n=this.clone(),i=se(l,c,!0);return i&&(n.$L=i),n},r.clone=function(){return Y.w(this.$d,this)},r.toDate=function(){return new Date(this.valueOf())},r.toJSON=function(){return this.isValid()?this.toISOString():null},r.toISOString=function(){return this.$d.toISOString()},r.toString=function(){return this.$d.toUTCString()},v}(),fe=re.prototype;return N.prototype=fe,[["$ms",T],["$s",_],["$m",I],["$H",u],["$W",$],["$M",M],["$y",w],["$D",U]].forEach(function(v){fe[v[1]]=function(r){return this.$g(r,v[0],v[1])}}),N.extend=function(v,r){return v.$i||(v(r,re,N),v.$i=!0),N},N.locale=se,N.isDayjs=ne,N.unix=function(v){return N(1e3*v)},N.en=F[s],N.Ls=F,N.p={},N})}(De)),De.exports}var kt=et();const tt=Oe(kt);var nt={exports:{}};(function(m,Z){(function(S,b){m.exports=b()})(He,function(){return function(S,b,x){S=S||{};var T=b.prototype,_={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function I($,B,M,C){return T.fromToBase($,B,M,C)}x.en.relativeTime=_,T.fromToBase=function($,B,M,C,w){for(var U,J,k,z=M.$locale().relativeTime||_,V=S.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],o=V.length,R=0;R<o;R+=1){var s=V[R];s.d&&(U=C?x($).diff(M,s.d,!0):M.diff($,s.d,!0));var F=(S.rounding||Math.round)(Math.abs(U));if(k=U>0,F<=s.r||!s.r){F<=1&&R>0&&(s=V[R-1]);var ae=z[s.l];w&&(F=w(""+F)),J=typeof ae=="string"?ae.replace("%d",F):ae(F,B,s.l,k);break}}if(B)return J;var ne=k?z.future:z.past;return typeof ne=="function"?ne(J):ne.replace("%s",J)},T.to=function($,B){return I($,B,this,!0)},T.from=function($,B){return I($,B,this)};var u=function($){return $.$u?x.utc():x()};T.toNow=function($){return this.to(u(this),$)},T.fromNow=function($){return this.from(u(this),$)}}})})(nt);var Vt=nt.exports;const Mt=Oe(Vt);var at={exports:{}};(function(m,Z){(function(S,b){m.exports=b(et())})(He,function(S){function b(_){return _&&typeof _=="object"&&"default"in _?_:{default:_}}var x=b(S),T={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(_,I){return I==="W"?_+"周":_+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(_,I){var u=100*_+I;return u<600?"凌晨":u<900?"早上":u<1100?"上午":u<1300?"中午":u<1800?"下午":"晚上"}};return x.default.locale(T,null,!0),T})})(at);var Ct=at.exports;const Dt=Oe(Ct);tt.extend(Mt);tt.locale(Dt);function St(m,Z=2){if(m===0)return"0 bytes";const S=1024,b=Z<0?0:Z,x=["bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],T=Math.floor(Math.log(m)/Math.log(S));return`${Number.parseFloat((m/S**T).toFixed(b))} ${x[T]}`}const be=he({__name:"DialogCloseBtn",props:{innerClass:String},emits:["click","update:modelValue"],setup(m,{emit:Z}){const S=m,b=Z;function x(){b("update:modelValue",!1),b("click")}return(T,_)=>{const I=Ae("IconBtn");return p(),ee("span",{class:lt(S.innerClass?S.innerClass:"absolute right-3 top-1"),onClick:ue(x,["stop"])},[e(I,null,{default:t(()=>[e(K,{icon:"mdi-close"})]),_:1})],2)}}}),It={class:"w-full h-full"},Tt=he({__name:"MediaIdSelector",props:ze({type:String,mediaType:String},{mediaId:{},mediaIdModifiers:{}}),emits:ze(["close"],["update:mediaId"]),setup(m,{emit:Z}){const S=m,b=Z,x=ot(m,"mediaId"),T=L([]),_=L(""),I=L(!1),u=L(null);function $(C){x.value=C.tmdbid||C.doubanid,b("close")}function B(C=""){return C?C.replace("original","w500"):""}async function M(){if(_)try{I.value=!0;const C=await ie.get("media/search",{params:{title:_.value,count:20,media_type:S.mediaType}});T.value=[];for(const w of C)S.type&&S.type!==w.source||T.value.push({tmdbid:w.tmdbid||0,doubanid:w.douban_id||"",poster:B(w.poster_path),title:`${w.title}（${w.year}）`,overview:`<span class="text-primary">${w.type}</span> ${w.overview}`});I.value=!1}catch(C){console.error(C)}}return je(()=>{setTimeout(()=>{var C;(C=u.value)==null||C.focus()},500)}),(C,w)=>(p(),g(ve,{class:"mx-auto",width:"100%"},{default:t(()=>[e(Ie,null,{default:t(()=>[e(le,{ref_key:"inputKeyword",ref:u,modelValue:a(_),"onUpdate:modelValue":w[0]||(w[0]=U=>oe(_)?_.value=U:null),label:"输入名称搜索","single-line":"",placeholder:"电影或电视剧名称",variant:"solo","prepend-inner-icon":"mdi-magnify",flat:"",class:"mx-1",loading:a(I),"onClick:prependInner":M,onKeydown:rt(M,["enter"])},null,8,["modelValue","loading"]),e(be,{onClick:w[1]||(w[1]=()=>{b("close")})})]),_:1}),a(T).length>0?(p(),g(We,{key:0,lines:"three"},{default:t(()=>[(p(!0),ee(ye,null,Te(a(T),(U,J)=>(p(),g(Ye,{key:J,onClick:k=>$(U)},{prepend:t(()=>[e(Ze,{height:"75",width:"50",src:U.poster,"aspect-ratio":"2/3",class:"object-cover rounded shadow ring-gray-500 me-3",cover:""},{placeholder:t(()=>[ge("div",It,[e(Ee,{class:"object-cover aspect-w-2 aspect-h-3"})])]),_:2},1032,["src"])]),default:t(()=>[e(Le,null,{default:t(()=>[W(q(U.title),1)]),_:2},1024),e(Ke,{class:"mt-2",innerHTML:U.overview},null,8,["innerHTML"])]),_:2},1032,["onClick"]))),128))]),_:1})):O("",!0)]),_:1}))}}),Pe=Re(Tt,[["__scopeId","data-v-5ec6dc73"]]),Se=m=>!isNaN(m)||"请输入数字",Yt=he({__name:"FileTransferDialog",props:{storage:{type:String,default:()=>"local"},history_ids:Array,items:Array,target:String},emits:["done","close"],setup(m,{emit:Z}){const S=qe.useToast(),b=L(!0),x=Je(),T=Z,_=m,I=Ve(()=>_.items?_.items.length>1?`整理 - 共 ${_.items.length} 项`:`整理 - ${_.items[0].path}`:_.history_ids?`整理 - 共 ${_.history_ids.length} 项`:"手动整理"),u=it({dest_dir:_.target??"",tmdbid:null,doubanid:null,season:null,media_type:"",transfer_type:"",episode_format:"",episode_detail:"",episode_part:"",episode_offset:null,min_filesize:0,suffix:"",scrape:!0}),$=L(Array.from({length:101},(V,o)=>o).map(V=>({title:`第 ${V} 季`,value:V}))),B=L("themoviedb"),M=L(!1),C=L([]),w=Ve(()=>{const V=C.value.map(o=>o.path);return[...new Set(V)]});async function U(){!_.history_ids&&!_.items||(_.items&&await J(_.items),_.history_ids&&k(_.history_ids))}async function J(V){try{const o=await ie.post("transfer/manual",{items:V,history_ids:null,transferForm:u});S.success("已添加整理任务")}catch(o){console.log(o)}}async function k(V){try{const o=await ie.post("transfer/manual",{items:null,history_ids:V,transferForm:u});S.success("已添加整理任务")}catch(o){console.log(o)}}async function z(){try{const V=await ie.get("system/settings/media_directory");console.log(V),C.value=V}catch(V){console.log(V)}}return je(()=>{z()}),(V,o)=>{const R=Ae("VPathInput");return p(),g(xe,{scrollable:"","max-width":"50rem",fullscreen:!a(x).mdAndUp.value},{default:t(()=>[e(ve,{title:a(I),class:"rounded-t"},{default:t(()=>[e(be,{onClick:o[0]||(o[0]=s=>T("close"))}),e(we),e($e,null,{default:t(()=>[e(st,null,{default:t(()=>[e(_e,null,{default:t(()=>[e(Q,{cols:"12",md:"8"},{default:t(()=>[a(b)?(p(),g(ut,{key:0,modelValue:a(u).dest_dir,"onUpdate:modelValue":o[1]||(o[1]=s=>a(u).dest_dir=s),items:a(w),label:"目的路径",placeholder:"留空自动",hint:"整理目的路径，留空将自动匹配","persistent-hint":""},null,8,["modelValue","items"])):(p(),g(R,{key:1,label:"目的路径",modelValue:a(u).dest_dir,"onUpdate:modelValue":o[2]||(o[2]=s=>a(u).dest_dir=s),currentDir:"/",hint:"整理目的路径，留空将自动匹配"},null,8,["modelValue"]))]),_:1}),_.storage=="local"?(p(),g(Q,{key:0,cols:"12",md:"4"},{default:t(()=>[e(Me,{modelValue:a(u).transfer_type,"onUpdate:modelValue":o[3]||(o[3]=s=>a(u).transfer_type=s),label:"整理方式",items:[{title:"默认",value:""},{title:"移动",value:"move"},{title:"复制",value:"copy"},{title:"硬链接",value:"link"},{title:"软链接",value:"symlink"}],hint:"文件操作整理方式","persistent-hint":""},null,8,["modelValue"])]),_:1})):O("",!0)]),_:1}),e(_e,null,{default:t(()=>[e(Q,{cols:"12",md:"4"},{default:t(()=>[e(Me,{modelValue:a(u).media_type,"onUpdate:modelValue":o[4]||(o[4]=s=>a(u).media_type=s),label:"类型",items:[{title:"自动",value:""},{title:"电影",value:"movie"},{title:"电视剧",value:"tv"}],hint:"文件媒体类型","persistent-hint":""},null,8,["modelValue"])]),_:1}),e(Q,{cols:"12",md:"4"},{default:t(()=>[a(B)==="themoviedb"?(p(),g(le,{key:0,modelValue:a(u).tmdbid,"onUpdate:modelValue":o[5]||(o[5]=s=>a(u).tmdbid=s),disabled:a(u).media_type==="",label:"TheMovieDb编号",placeholder:"留空自动识别",rules:[a(Se)],"append-inner-icon":"mdi-magnify",hint:"按名称查询媒体编号，留空自动识别","persistent-hint":"","onClick:appendInner":o[6]||(o[6]=s=>M.value=!0)},null,8,["modelValue","disabled","rules"])):(p(),g(le,{key:1,modelValue:a(u).doubanid,"onUpdate:modelValue":o[7]||(o[7]=s=>a(u).doubanid=s),disabled:a(u).media_type==="",label:"豆瓣编号",placeholder:"留空自动识别",rules:[a(Se)],"append-inner-icon":"mdi-magnify",hint:"按名称查询媒体编号，留空自动识别","persistent-hint":"","onClick:appendInner":o[8]||(o[8]=s=>M.value=!0)},null,8,["modelValue","disabled","rules"]))]),_:1}),e(Q,{cols:"12",md:"4"},{default:t(()=>[Ge(e(Me,{modelValue:a(u).season,"onUpdate:modelValue":o[9]||(o[9]=s=>a(u).season=s),modelModifiers:{number:!0},label:"季",items:a($),hint:"指定季数","persistent-hint":""},null,8,["modelValue","items"]),[[Qe,a(u).media_type==="tv"]])]),_:1})]),_:1}),a(u).media_type==="tv"?(p(),g(_e,{key:0},{default:t(()=>[e(Q,{cols:"12",md:"8"},{default:t(()=>[e(le,{modelValue:a(u).episode_format,"onUpdate:modelValue":o[10]||(o[10]=s=>a(u).episode_format=s),label:"集数定位",placeholder:"使用{ep}定位集数",hint:"使用{ep}定位文件名中的集数部分以辅助识别","persistent-hint":""},null,8,["modelValue"])]),_:1}),e(Q,{cols:"12",md:"4"},{default:t(()=>[e(le,{modelValue:a(u).episode_part,"onUpdate:modelValue":o[11]||(o[11]=s=>a(u).episode_part=s),label:"指定Part",placeholder:"如part1",hint:"指定Part，如part1","persistent-hint":""},null,8,["modelValue"])]),_:1}),e(Q,{cols:"12",md:"6"},{default:t(()=>[e(le,{modelValue:a(u).episode_detail,"onUpdate:modelValue":o[12]||(o[12]=s=>a(u).episode_detail=s),label:"指定集数",placeholder:"起始集,终止集，如1或1,2",hint:"指定集数或范围，如1或1,2","persistent-hint":""},null,8,["modelValue"])]),_:1}),e(Q,{cols:"12",md:"6"},{default:t(()=>[e(le,{modelValue:a(u).episode_offset,"onUpdate:modelValue":o[13]||(o[13]=s=>a(u).episode_offset=s),modelModifiers:{number:!0},label:"集数偏移",placeholder:"如-10",hint:"集数偏移运算，如-9或+9","persistent-hint":""},null,8,["modelValue"])]),_:1})]),_:1})):O("",!0),e(_e,null,{default:t(()=>[e(Q,{cols:"12",md:"8"},{default:t(()=>[e(le,{modelValue:a(u).suffix,"onUpdate:modelValue":o[14]||(o[14]=s=>a(u).suffix=s),label:"自定义后缀",hint:"指定整理后的文件名后缀,如指定制作组为ADWeb","persistent-hint":""},null,8,["modelValue"])]),_:1}),e(Q,{cols:"12",md:"4"},{default:t(()=>[e(le,{modelValue:a(u).min_filesize,"onUpdate:modelValue":o[15]||(o[15]=s=>a(u).min_filesize=s),modelModifiers:{number:!0},label:"文件大小（MB）",rules:[a(Se)],placeholder:"0",hint:"只整理大于指定值的文件","persistent-hint":""},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(_e,null,{default:t(()=>[e(Q,{cols:"12",md:"6"},{default:t(()=>[e(Fe,{modelValue:a(u).scrape,"onUpdate:modelValue":o[16]||(o[16]=s=>a(u).scrape=s),label:"刮削元数据",hint:"整理完成后自动刮削元数据","persistent-hint":""},null,8,["modelValue"])]),_:1}),e(Q,{cols:"12",md:"6"},{default:t(()=>[e(Fe,{modelValue:a(b),"onUpdate:modelValue":o[17]||(o[17]=s=>oe(b)?b.value=s:null),label:"选择媒体库",hint:"开启后目的路径会显示媒体文件夹列表","persistent-hint":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(Ue,{class:"pt-3"},{default:t(()=>[e(Xe),e(ke,{variant:"elevated",onClick:U,"prepend-icon":"mdi-arrow-right-bold",class:"px-5"},{default:t(()=>o[23]||(o[23]=[W(" 开始整理 ")])),_:1})]),_:1})]),_:1},8,["title"]),e(xe,{modelValue:a(M),"onUpdate:modelValue":o[22]||(o[22]=s=>oe(M)?M.value=s:null),width:"40rem",scrollable:"","max-height":"85vh"},{default:t(()=>[a(B)==="themoviedb"?(p(),g(Pe,{key:0,mediaId:a(u).tmdbid,"onUpdate:mediaId":o[18]||(o[18]=s=>a(u).tmdbid=s),onClose:o[19]||(o[19]=s=>M.value=!1),type:a(B),mediaType:a(u).media_type},null,8,["mediaId","type","mediaType"])):(p(),g(Pe,{key:1,mediaId:a(u).doubanid,"onUpdate:mediaId":o[20]||(o[20]=s=>a(u).doubanid=s),onClose:o[21]||(o[21]=s=>M.value=!1),type:a(B)},null,8,["mediaId","type"]))]),_:1},8,["modelValue"])]),_:1},8,["fullscreen"])}}}),Lt=he({__name:"ProgressDialog",props:{value:Number,text:String},setup(m){const Z=m;return(S,b)=>(p(),g(xe,{scrim:!1,width:"25rem"},{default:t(()=>[e(ve,{color:"primary"},{default:t(()=>[e($e,{class:"text-center"},{default:t(()=>[W(q(Z.text)+" ",1),e(dt,{color:"white",class:"mb-0 mt-1","model-value":Z.value,indeterminate:""},null,8,["model-value"])]),_:1})]),_:1})]),_:1}))}}),Ut={key:0,class:"d-flex justify-space-between flex-wrap flex-md-nowrap flex-column flex-md-row"},Bt={key:0,class:"ma-auto"},Ht={class:"w-full h-full"},Ot=he({__name:"MediaInfoCard",props:{context:Object},setup(m){function Z(b=""){return b?b.replace("original","w500"):""}function S(b,x){if(!b||!x)return;const T=`https://www.themoviedb.org/${b==="电影"?"movie":"tv"}/${x}`;window.open(T,"_blank")}return(b,x)=>Ge((p(),ee("div",null,[e(Q,null,{default:t(()=>{var T,_,I,u,$,B,M,C,w,U,J;return[(_=(T=m.context)==null?void 0:T.media_info)!=null&&_.title?(p(),ee("div",Ut,[(u=(I=m.context)==null?void 0:I.media_info)!=null&&u.poster_path?(p(),ee("div",Bt,[e(Ze,{width:"10rem","aspect-ratio":"2/3",class:"object-cover aspect-w-2 aspect-h-3 rounded-lg ring-1 ring-gray-500",src:Z((B=($=m.context)==null?void 0:$.media_info)==null?void 0:B.poster_path),cover:""},{placeholder:t(()=>[ge("div",Ht,[e(Ee,{class:"object-cover aspect-w-2 aspect-h-3"})])]),_:1},8,["src"])])):O("",!0),ge("div",null,[e(Be,{class:"pb-1"},{default:t(()=>[e(ct,{class:"text-center text-md-left"},{default:t(()=>{var k,z,V,o,R,s;return[W(q(((z=(k=m.context)==null?void 0:k.media_info)==null?void 0:z.title)||((o=(V=m.context)==null?void 0:V.media_info)==null?void 0:o.title))+" "+q((s=(R=m.context)==null?void 0:R.media_info)==null?void 0:s.season_episode),1)]}),_:1}),e(mt,{class:"text-center text-md-left"},{default:t(()=>{var k,z,V,o;return[W(q(((z=(k=m.context)==null?void 0:k.media_info)==null?void 0:z.year)||((o=(V=m.context)==null?void 0:V.media_info)==null?void 0:o.year)),1)]}),_:1})]),_:1}),(C=(M=m.context)==null?void 0:M.media_info)!=null&&C.overview?(p(),g($e,{key:0,class:"line-clamp-4 overflow-hidden text-ellipsis text-center text-md-left ..."},{default:t(()=>{var k,z;return[W(q((z=(k=m.context)==null?void 0:k.media_info)==null?void 0:z.overview),1)]}),_:1})):O("",!0),ge("div",null,[(w=m.context)!=null&&w.new_filename?(p(),g($e,{key:0,class:"line-clamp-4 overflow-hidden text-ellipsis text-center text-md-left ..."},{default:t(()=>{var k;return[W(q((k=m.context)==null?void 0:k.new_filename),1)]}),_:1})):O("",!0)]),e(Be,{class:"text-center text-md-left"},{default:t(()=>{var k,z,V,o,R,s,F,ae,ne,se,N,Y,re,fe,v,r,l,c;return[(z=(k=m.context)==null?void 0:k.media_info)!=null&&z.type||(o=(V=m.context)==null?void 0:V.media_info)!=null&&o.type?(p(),g(ce,{key:0,variant:"elevated",color:"primary",class:"me-1 mb-1 text-white bg-blue-500"},{default:t(()=>{var n,i,h,D;return[W(q(((i=(n=m.context)==null?void 0:n.media_info)==null?void 0:i.type)||((D=(h=m.context)==null?void 0:h.media_info)==null?void 0:D.type)),1)]}),_:1})):O("",!0),(s=(R=m.context)==null?void 0:R.media_info)!=null&&s.category?(p(),g(ce,{key:1,variant:"elevated",color:"primary",class:"me-1 mb-1 text-white bg-blue-500"},{default:t(()=>{var n,i;return[W(q((i=(n=m.context)==null?void 0:n.media_info)==null?void 0:i.category),1)]}),_:1})):O("",!0),(ae=(F=m.context)==null?void 0:F.media_info)!=null&&ae.tmdbid?(p(),g(ce,{key:2,variant:"elevated",color:"success",class:"me-1 mb-1",onClick:x[0]||(x[0]=n=>{var i,h,D,A;return S(((h=(i=m.context)==null?void 0:i.media_info)==null?void 0:h.type)||"",(A=(D=m.context)==null?void 0:D.media_info)==null?void 0:A.tmdbid)})},{default:t(()=>{var n,i;return[W(q((i=(n=m.context)==null?void 0:n.media_info)==null?void 0:i.tmdbid),1)]}),_:1})):O("",!0),(se=(ne=m.context)==null?void 0:ne.media_info)!=null&&se.source?(p(),g(ce,{key:3,variant:"elevated",color:"error",class:"me-1 mb-1 text-white bg-red-500"},{default:t(()=>{var n,i;return[W(q((i=(n=m.context)==null?void 0:n.media_info)==null?void 0:i.source),1)]}),_:1})):O("",!0),(Y=(N=m.context)==null?void 0:N.media_info)!=null&&Y.resolution?(p(),g(ce,{key:4,variant:"elevated",color:"error",class:"me-1 mb-1 text-white bg-red-500"},{default:t(()=>{var n,i;return[W(q((i=(n=m.context)==null?void 0:n.media_info)==null?void 0:i.resolution),1)]}),_:1})):O("",!0),(fe=(re=m.context)==null?void 0:re.media_info)!=null&&fe.video_codec?(p(),g(ce,{key:5,variant:"elevated",color:"orange",class:"me-1 mb-1 text-white bg-orange-500"},{default:t(()=>{var n,i;return[W(q((i=(n=m.context)==null?void 0:n.media_info)==null?void 0:i.video_codec),1)]}),_:1})):O("",!0),(r=(v=m.context)==null?void 0:v.media_info)!=null&&r.audio_codec?(p(),g(ce,{key:6,variant:"elevated",class:"me-1 mb-1 text-white bg-orange-500"},{default:t(()=>{var n,i;return[W(q((i=(n=m.context)==null?void 0:n.media_info)==null?void 0:i.audio_codec),1)]}),_:1})):O("",!0),(c=(l=m.context)==null?void 0:l.media_info)!=null&&c.release_group?(p(),g(ce,{key:7,variant:"elevated",color:"cyan",class:"me-1 mb-1 text-white bg-cyan-500"},{default:t(()=>{var n,i;return[W(q((i=(n=m.context)==null?void 0:n.media_info)==null?void 0:i.release_group),1)]}),_:1})):O("",!0)]}),_:1})])])):O("",!0),(J=(U=m.context)==null?void 0:U.media_info)!=null&&J.title?O("",!0):(p(),g(ft,{key:1,icon:"mdi-alert-circle-outline"},{default:t(()=>x[1]||(x[1]=[W(" 识别失败，无法识别到有效信息！ ")])),_:1}))]}),_:1})],512)),[[Qe,m.context]])}}),At={class:"file-browser"},jt={key:0},zt={key:1,class:"flex"},Ft=he({__name:"FileBrowser",setup(m){const Z=Je(),S=L([]),b={name:"根目录",path:"/",type:"dir",size:0,extension:"",children:[]},x=L([b]),T=pt(),_=qe.useToast(),I=L(!1);L(!0);const u=L(!1),$=L(!1),B=L("请稍候 ..."),M=L(0);L([]),L("");const C=L(!1),w=L(!1),U=L(""),J=L(),k=L([]),z=L(),V=L(!1);vt(V,y=>{y||(z.value=void 0)});const o=L([{title:"识别",value:1,show:!0,props:{prependIcon:"mdi-text-recognition",click:y=>{N(y.path||"")}}},{title:"刮削",value:2,show:!0,props:{prependIcon:"mdi-auto-fix",click:y=>{}}},{title:"重命名",value:3,show:!0,props:{prependIcon:"mdi-rename",click:re}},{title:"整理",value:4,show:!0,props:{prependIcon:"mdi-folder-arrow-right",click:v}},{title:"删除",value:5,show:!0,props:{prependIcon:"mdi-delete-outline",color:"error",click:r}}]),R=L([]),s=L(!1),F=L(""),ae=L("name");function ne(){const y=x.value??[];i(y[y.length-2],y.length-2)}function se(){I.value=!I.value,I.value||(k.value=[])}async function N(y){var d,H;try{$.value=!0,B.value=`正在识别: ${y.split("/").pop()} ...`,M.value=0;try{z.value=await ie.get("media/recognize_file",{params:{path:y}})}catch{_.error(`${y} 识别失败！`)}$.value=!1,z.value||_.error(`${y} 识别失败！`),V.value=!!((H=(d=z.value)==null?void 0:d.media_info)!=null&&H.title)}catch(f){console.error(f)}}function Y(y){}function re(y){J.value=y,U.value=y.name,C.value=!0}function fe(){J.value.name==U.value?console.log("名称没有发生更改"):(ie.get("/local/rename",{params:{path:J.value.path,new_name:U.value}}),E()),C.value=!1}function v(y){R.value=[y],w.value=!0}async function r(y,d){if(!(d&&!await T({title:"确认",content:`是否确认删除${y.type==="dir"?"目录":"文件"} ${y.name}？`})))try{ie.get("/local/delete",{params:{path:y.path}}),E()}catch(H){console.log(H)}}async function l(){}function c(){R.value=k.value,w.value=!0}async function n(){await T({title:"确认",content:`是否确认删除选中的 ${k.value.length} 个项目？`})&&($.value=!0,M.value=0,k.value.every(async d=>{B.value=`正在删除 ${d.name} ...`,await r(d,!1)}),$.value=!1,E())}function i(y,d){P(y),x.value.splice(d+1)}const h=Ve(()=>x.value[x.value.length-1]);async function D(){try{ie.get("/local/mkdir",{params:{path:`${h.value.path}/${F.value}`}})}catch(y){console.log(y)}s.value=!1,F.value="",E()}function A(y){if(y.type!=="file"){if(I.value)return k.value.includes(y)?k.value=k.value.filter(d=>d!==y):k.value.push(y),k.value=Array.from(new Set(k.value)),!1;P(y),x.value.includes(y)||x.value.push(y)}}async function P(y){return ie.get("/local/listfile?path="+y.path).then(d=>{S.value=d}).catch(d=>console.warn(d))}function E(){x.value.length>0?P(x.value[x.value.length-1]):P(b)}async function X(){let y=await ie.get("/local/listfile?path=/");S.value=y,x.value=[b]}const de=L("height: calc(100vh - 13.5rem - env(safe-area-inset-bottom)");return Ve(()=>ae.value==="time"?"mdi-sort-clock-ascending-outline":"mdi-sort-alphabetical-ascending"),je(()=>{X()}),(y,d)=>{const H=Ae("IconBtn");return p(),ee("div",At,[e(ve,{class:"mx-auto"},{default:t(()=>[e(Ie,null,{default:t(()=>[(p(!0),ee(ye,null,Te(a(x),(f,G)=>(p(),ee(ye,{key:G},[a(Z).mdAndUp.value||G===0?(p(),g(ke,{key:0,variant:"text","input-value":G===a(x).length-1,class:"px-1",style:{height:"inherit"},color:"on-primary",onClick:j=>i(f,G)},{default:t(()=>[f.path==="/"?(p(),g(K,{key:0,icon:" mdi-folder-multiple-outline",class:"mx-3",size:"24"})):(p(),g(K,{key:1,icon:" mdi-chevron-right"})),W(" "+q(f.name),1)]),_:2},1032,["input-value","onClick"])):O("",!0)],64))),128)),d[14]||(d[14]=ge("div",{class:"flex-grow-1"},null,-1)),a(x).length>1?(p(),g(pe,{key:0,text:"返回上一级"},{activator:t(({props:f})=>[e(H,me(f,{onClick:ne}),{default:t(()=>[e(K,{icon:"mdi-arrow-up-bold-outline"})]),_:2},1040)]),_:1})):O("",!0),e(xe,{modelValue:a(s),"onUpdate:modelValue":d[2]||(d[2]=f=>oe(s)?s.value=f:null),"max-width":"50rem"},{activator:t(({props:f})=>[e(H,ht(yt(f)),{default:t(()=>[e(pe,{text:"新建文件夹"},{activator:t(({props:G})=>[e(K,me(G,{icon:"mdi-folder-plus-outline"}),null,16)]),_:1})]),_:2},1040)]),default:t(()=>[e(ve,{title:"新建文件夹"},{default:t(()=>[e(be,{onClick:d[0]||(d[0]=f=>s.value=!1)}),e(we),e($e,null,{default:t(()=>[e(le,{modelValue:a(F),"onUpdate:modelValue":d[1]||(d[1]=f=>oe(F)?F.value=f:null),label:"名称"},null,8,["modelValue"])]),_:1}),e(Ue,null,{default:t(()=>[d[13]||(d[13]=ge("div",{class:"flex-grow-1"},null,-1)),e(ke,{disabled:!a(F),variant:"elevated",onClick:D,"prepend-icon":"mdi-check",class:"px-5 me-3"},{default:t(()=>d[12]||(d[12]=[W(" 新建 ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(we),e(Ie,{class:"batch-toolbar",style:{"border-radius":"5px"}},{default:t(()=>[e(H,{onClick:E},{default:t(()=>[e(K,{color:"primary"},{default:t(()=>d[15]||(d[15]=[W(" mdi-refresh ")])),_:1})]),_:1}),e(Xe),e(H,{onClick:se},{default:t(()=>[a(I)?(p(),g(K,{key:0,color:"primary"},{default:t(()=>d[16]||(d[16]=[W(" mdi-selection-remove ")])),_:1})):(p(),g(K,{key:1,color:"primary"},{default:t(()=>d[17]||(d[17]=[W("mdi-select")])),_:1}))]),_:1}),a(k).length>0?(p(),ee("span",jt,[e(H,{onClick:ue(l,["stop"])},{default:t(()=>[e(K,{color:"primary",icon:"mdi-auto-fix"})]),_:1}),e(H,{onClick:ue(c,["stop"])},{default:t(()=>[e(K,{color:"primary",icon:"mdi-folder-arrow-right"})]),_:1}),e(H,{onClick:ue(n,["stop"])},{default:t(()=>[e(K,{icon:"mdi-delete-outline",color:"error"})]),_:1})])):O("",!0)]),_:1}),e(_t,{items:a(S),style:gt(a(de))},{default:t(({item:f})=>[e(xt,null,{default:t(G=>[e(Ye,me(G.props,{class:"px-[1rem] pe-1",onClick:j=>A(f)}),{prepend:t(()=>{var j;return[a(I)?(p(),g(bt,{key:0},{default:t(()=>[e($t,{modelValue:a(k),"onUpdate:modelValue":d[3]||(d[3]=te=>oe(k)?k.value=te:null),value:f},null,8,["modelValue","value"])]),_:2},1024)):(p(),ee(ye,{key:1},[a(Ce)&&f.extension?(p(),g(K,{key:0,icon:a(Ce)[f.extension.toLowerCase()]||((j=a(Ce))==null?void 0:j.other)},null,8,["icon"])):(p(),g(K,{key:1,icon:"mdi-folder"}))],64))]}),append:t(()=>[a(Z).smAndDown.value&&!a(I)?(p(),g(H,{key:0},{default:t(()=>[e(K,{icon:"mdi-dots-vertical"}),e(wt,{activator:"parent","close-on-content-click":""},{default:t(()=>[e(We,null,{default:t(()=>[(p(!0),ee(ye,null,Te(a(o),(j,te)=>(p(),ee(ye,{key:te},[j.show?(p(),g(Ye,{key:0,variant:"plain","base-color":j.props.color,onClick:Pt=>j.props.click(f)},{prepend:t(()=>[e(K,{icon:j.props.prependIcon},null,8,["icon"])]),default:t(()=>[e(Le,{textContent:q(j.title)},null,8,["textContent"])]),_:2},1032,["base-color","onClick"])):O("",!0)],64))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)):O("",!0),G.isHovering&&a(Z).mdAndUp.value&&!a(I)?(p(),ee("span",zt,[e(pe,{text:"识别"},{activator:t(({props:j})=>[e(H,me(j,{onClick:ue(te=>N(f.path),["stop"])}),{default:t(()=>[e(K,{icon:"mdi-text-recognition"})]),_:2},1040,["onClick"])]),_:2},1024),e(pe,{text:"刮削"},{activator:t(({props:j})=>[e(H,me(j,{onClick:ue(te=>void 0,["stop"])}),{default:t(()=>[e(K,{icon:"mdi-auto-fix"})]),_:2},1040,["onClick"])]),_:2},1024),e(pe,{text:"重命名"},{activator:t(({props:j})=>[e(H,me(j,{onClick:ue(te=>re(f),["stop"])}),{default:t(()=>[e(K,{icon:"mdi-rename"})]),_:2},1040,["onClick"])]),_:2},1024),e(pe,{text:"整理"},{activator:t(({props:j})=>[e(H,me(j,{onClick:ue(te=>v(f),["stop"])}),{default:t(()=>[e(K,{icon:"mdi-folder-arrow-right"})]),_:2},1040,["onClick"])]),_:2},1024),e(pe,{text:"删除"},{activator:t(({props:j})=>[e(H,me(j,{onClick:ue(te=>r(f,!0),["stop"])}),{default:t(()=>[e(K,{icon:"mdi-delete-outline",color:"error"})]),_:2},1040,["onClick"])]),_:2},1024)])):O("",!0)]),default:t(()=>[e(Le,{textContent:q(f.name)},null,8,["textContent"]),f.size?(p(),g(Ke,{key:0},{default:t(()=>[W(q(a(St)(f.size)),1)]),_:2},1024)):O("",!0)]),_:2},1040,["onClick"])]),_:2},1024)]),_:1},8,["items","style"])]),_:1}),a(C)?(p(),g(xe,{key:0,modelValue:a(C),"onUpdate:modelValue":d[6]||(d[6]=f=>oe(C)?C.value=f:null),"max-width":"50rem"},{default:t(()=>[e(ve,{title:"重命名"},{default:t(()=>[e(be,{onClick:d[4]||(d[4]=f=>C.value=!1)}),e(we),e($e,null,{default:t(()=>[e(_e,null,{default:t(()=>[e(Q,{cols:"12"},{default:t(()=>[e(le,{modelValue:a(U),"onUpdate:modelValue":d[5]||(d[5]=f=>oe(U)?U.value=f:null),label:"新名称",loading:a(u)},null,8,["modelValue","loading"])]),_:1})]),_:1})]),_:1}),e(Ue,null,{default:t(()=>[e(ke,{disabled:!a(U),variant:"elevated",onClick:fe,"prepend-icon":"mdi-check",class:"px-5 me-3"},{default:t(()=>d[18]||(d[18]=[W(" 确定 ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):O("",!0),a(w)?(p(),g(Yt,{key:1,modelValue:a(w),"onUpdate:modelValue":d[7]||(d[7]=f=>oe(w)?w.value=f:null),items:a(R),onClose:d[8]||(d[8]=f=>w.value=!1)},null,8,["modelValue","items"])):O("",!0),a($)?(p(),g(Lt,{key:2,modelValue:a($),"onUpdate:modelValue":d[9]||(d[9]=f=>oe($)?$.value=f:null),text:a(B),value:a(M)},null,8,["modelValue","text","value"])):O("",!0),a(V)?(p(),g(xe,{key:3,modelValue:a(V),"onUpdate:modelValue":d[11]||(d[11]=f=>oe(V)?V.value=f:null),width:"50rem"},{default:t(()=>[e(ve,null,{default:t(()=>[e(be,{onClick:d[10]||(d[10]=f=>V.value=!1)}),e(Be,null,{default:t(()=>[e(Ot,{context:a(z)},null,8,["context"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):O("",!0)])}}}),Nt=Re(Ft,[["__scopeId","data-v-043154c4"]]),Zt=he({__name:"file_manager",setup(m){return(Z,S)=>(p(),ee("div",null,[e(Nt)]))}});export{Zt as default};
